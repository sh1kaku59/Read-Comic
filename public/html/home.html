<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Comic</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto:wght@400&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo">
            <a href="#">
                <img src="img/logo.png" alt="Comic Reading Logo">        
            </a>
        </div>
        <div class="auth-links">
            <button id="login-btn">Log In / Registration</button>
            <button id="profile-btn">Profile</button>
            <button id="logout-btn" style="display:none;">Log Out</button>
        </div>
    </header>

    <main>
        <section class="hero-section">
            <div class="hero-content">
                <img src="text.gif" alt="Discover New Comics" class="hero-image">
                <p>Discover new comics, your favorite comics, all in one place</p>
            </div>
        </section>

        <section class="search-section">
            <div class="search-bar">
                <input type="text" id="comic-search" placeholder="Enter comic title or author">
                <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>            
        </section>

        <section class="filters" data-aos="fade-right" data-aos-duration="1000" data-aos-delay="200">
            <label for="sort-select">Sort by:</label>
            <select id="sort-select" class="styled-select">
                <option value="nameAZ">Title (A - Z)</option>
                <option value="nameZA">Title (Z - A)</option>
                <option value="release">Release Date</option>
                <option value="status">Status</option>
            </select>
        
            <label for="category-select">Genre:</label>
            <select id="category-select" class="styled-select">
                <option value="all">All</option>
                <option value="1">Action</option>
                <option value="2">Adventure</option>
                <option value="3">Comedy</option>
                <option value="4">Romance</option>
                <option value="5">Sci-Fi</option>
                <option value="6">Horror-Action</option>
            </select>
        </section>        

        <section id="comics-list" data-aos="fade-up" data-aos-duration="800">

        </section>

        <section class="other">
            <section class="section1" data-aos="fade-up" data-aos-duration="800">
                <h2 class="title1" data-aos="fade-up" data-aos-duration="800">Ton of Genres</h2>
                <div class="featured-comic1" data-aos="fade-up" data-aos-duration="800">
                    <img src="img/gif1.gif" alt="Comic Title 1" class="comic-cover1">
                    <p> Explore from action-packed adventures and heartwarming romances to thrilling mysteries and fantastical journeys. Our collection celebrates the rich tapestry of storytelling, inviting you to immerse yourself in diverse narratives that cater to every taste. Whether you crave humor, drama, or science fiction, there's something for everyone. Dive into new worlds and discover characters that resonate with you!</p>
                </div>
            </section>

            <section class="others">
                <section class="section2" data-aos="fade-up" data-aos-duration="800">
                    <img src="img/gif3.gif" alt="Comic Title 2" class="comic-cover2" data-aos="fade-left" data-aos-duration="800">
                    <h2 class="title2">Featured Comics</h2>
                    <div class="featured-comic3" data-aos="fade-right" data-aos-duration="800">
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured1.jpg" alt="Featured Comic 1" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 1</p>
                            </div>
                        </div>
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured2.jpg" alt="Featured Comic 2" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 2</p>
                            </div>
                        </div>
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured3.jpg" alt="Featured Comic 3" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 3</p>
                            </div>
                        </div>
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured4.jpg" alt="Featured Comic 4" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 4</p>
                            </div>
                        </div>
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured5.jpg" alt="Featured Comic 5" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 5</p>
                            </div>
                        </div>
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured6.jpg" alt="Featured Comic 6" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 6</p>
                            </div>
                        </div>
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured7.jpg" alt="Featured Comic 7" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 7</p>
                            </div>
                        </div>
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured8.jpg" alt="Featured Comic 8" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 8</p>
                            </div>
                        </div>
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured9.jpg" alt="Featured Comic 9" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 9</p>
                            </div>
                        </div>
                        <div class="comic-card">
                            <div class="comic-front">
                                <img src="img/featured10.jpg" alt="Featured Comic 10" class="comic-cover3">
                            </div>
                            <div class="comic-back">
                                <p>Description for Featured Comic 10</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="section3" data-aos="fade-up" data-aos-duration="800">
                    <h2 class="title2">Coming Soon...</h2>
                </section>

            </section>

        </section>
        
    </main>

    <footer>
        <p>&copy; 2024 Reading Comic Website | <a href="#">Privacy Policy</a></p>
    </footer>

    <script>
        //-------------------------------------------- Kiểm tra trạng thái đăng nhập/đăng ký --------------------------------------------//
        function checkLoginStatus() {
            fetch('/api/check-login', {
                method: 'GET',
                credentials: 'include'  // Đảm bảo yêu cầu bao gồm session cookie
            })
            .then(response => response.json())
            .then(data => {
                if (data.isLoggedIn) {
                    document.getElementById('login-btn').style.display = 'none';
                    document.getElementById('profile-btn').style.display = 'inline-block';
                    document.getElementById('logout-btn').style.display = 'inline-block';
                } else {
                    document.getElementById('login-btn').style.display = 'inline-block';
                    document.getElementById('profile-btn').style.display = 'none';
                    document.getElementById('logout-btn').style.display = 'none';
                }
            })
            .catch(error => console.error('Lỗi khi kiểm tra trạng thái đăng nhập:', error));
        }

        //-------------------------------------------- Đăng Nhập/Đăng Ký --------------------------------------------//
        document.getElementById('login-btn').addEventListener('click', function() {
            window.location.href = '/login-sigin.html'; // Chuyển hướng đến trang đăng nhập/đăng ký
        });

        //-------------------------------------------- Hồ Sơ (chỉ vào khi đã đăng nhập) --------------------------------------------//
        document.getElementById('profile-btn').addEventListener('click', function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            
            if (isLoggedIn) {
                window.location.href = '/profile.html'; // Chuyển hướng đến trang hồ sơ
            } else {
                alert('Bạn cần đăng nhập/đăng ký để truy cập hồ sơ.');
                window.location.href = '/login-sigin.html'; // Chuyển hướng đến trang đăng nhập/đăng ký
            }
        });

        //-------------------------------------------- Đăng Xuất --------------------------------------------//
        document.getElementById('logout-btn').addEventListener('click', function() {
            fetch('/logout', {
                method: 'POST',
                credentials: 'include'  // Gửi session cookie đến server
            })
            .then(() => {
                checkLoginStatus();  // Cập nhật giao diện sau khi đăng xuất
                alert('Bạn đã đăng xuất thành công.');
                window.location.reload();  // Tải lại trang để cập nhật trạng thái
            })
            .catch(error => console.error('Lỗi khi đăng xuất:', error));
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Kiểm tra nếu người dùng đã đăng nhập
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';

            const loginBtn = document.getElementById('login-btn');
            const profileBtn = document.getElementById('profile-btn');
            const existingLogoutBtn = document.getElementById('logout-btn'); // Tìm nút logout nếu đã có
            
            // Kiểm tra trạng thái đăng nhập
            if (isLoggedIn) {
                loginBtn.style.display = 'none';
                profileBtn.style.display = 'block';
                existingLogoutBtn.style.display = 'block';
            } else {
                profileBtn.style.display = 'none';
                existingLogoutBtn.style.display = 'none';
            }
        });

        //-------------------------------------------- Sau khi Đăng Nhập thành công --------------------------------------------//
        function loginSuccess() {
            //localStorage.setItem('isLoggedIn', 'true');
            checkLoginStatus();
            window.location.href = '/';
        }

        //-------------------------------------------- Sau khi Đăng Ký thành công --------------------------------------------//
        function signupSuccess() {
            // Gọi API kiểm tra trạng thái đăng nhập
            checkLoginStatus(); // Kiểm tra lại trạng thái đăng nhập từ server
            window.location.href = '/'; // Chuyển hướng đến trang chủ
        }

        //-------------------------------------------- Sau khi Xóa tài khoản thành công --------------------------------------------//
        function accountDeleted() {
            localStorage.removeItem('isLoggedIn', 'false'); // Xóa trạng thái đăng nhập
            checkLoginStatus(); // Cập nhật giao diện sau khi xóa tài khoản
            window.location.href = '/login'; // Điều hướng về trang chủ
        }

        //-------------------------------------------- Kiểm tra trạng thái đăng nhập khi tải trang --------------------------------------------//
        document.addEventListener('DOMContentLoaded', () => {
            checkLoginStatus();
        });
        
        //-------------------------------------------- Tìm kiếm truyện --------------------------------------------//
        document.getElementById('search-btn').addEventListener('click', function () {
            let searchTerm = document.getElementById('comic-search').value; // Lấy giá trị tên tác giả và tên truyện

            // Nếu người dùng điền tên truyện hoặc tác giả, gọi hàm tìm kiếm
            if (searchTerm) {
                let query = `/api/search_comics?search=${encodeURIComponent(searchTerm)}`;
                fetchComics(query);
            } else {
                // Nếu không điền, hiển thị lại tất cả truyện
                fetchComics('/api/comics');
            }
        });
        
        //-------------------------------------------- Hàm fetch dữ liệu từ API --------------------------------------------//
        function fetchComics(query) {
            fetch(query)
                .then(response => response.json())
                .then(data => {
                    console.log('Kết quả tìm kiếm:', data);
                    
                    // Xóa nội dung hiện tại của danh sách truyện
                    const comicsList = document.getElementById('comics-list');
                    comicsList.innerHTML = ''; // Xóa các truyện trước đó
                    
                    // Lặp qua dữ liệu truyện và tạo các mục hiển thị
                    data.forEach(comic => {
                        const comicItem = `
                            <div class="comic-item">
                                <div class="comic-image-container">
                                    <img src="${comic.hinhanh}" alt="${comic.tentruyen}" class="comic-image">
                                </div>
                                <div class="comic-details">
                                    <div class="comic-title">${comic.tentruyen}</div>
                                    <div class="comic-author">${comic.tacgia}</div>
                                    <div class="comic-description">${comic.mota}</div>
                                </div>
                            </div>
                        `;
                        
                        // Thêm mục truyện vào danh sách truyện
                        comicsList.innerHTML += comicItem; 
                    });
                })
                .catch(err => {
                    console.error('Lỗi tìm kiếm:', err);
                });
        }

        // Gọi fetchComics để hiển thị tất cả truyện khi tải trang
        fetchComics('/api/comics');

        //-------------------------------------------- Xử lý sắp xếp --------------------------------------------//
        document.getElementById('sort-select').addEventListener('change', function() {
            let sortOption = this.value;
            let category = document.getElementById('category-select').value;
            let query = `/api/comics?sortOption=${sortOption}&category=${category}`;
            fetchComics(query);
        });

        //-------------------------------------------- Xử lý lọc theo thể loại --------------------------------------------//
        document.getElementById('category-select').addEventListener('change', function() {
            let category = this.value;
            let sortOption = document.getElementById('sort-select').value;
            let query = `/api/comics?sortOption=${sortOption}&category=${category}`;
            fetchComics(query);
        });

        // Lấy thể loại khi tải trang
        fetchCategories();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script>
        AOS.init();
    </script>
</body>
</html>
